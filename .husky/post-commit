#!/usr/bin/env sh
. "$(dirname "$0")/_/husky.sh"

REPO_ROOT="$(git rev-parse --show-toplevel)"
[ -f "$REPO_ROOT/.guardrails/disabled" ] || exit 0

CHANGED="$(git diff-tree --no-commit-id --name-only -r HEAD 2>/dev/null | tr -d '\r')"
PROTECTED_PATTERN='^src/vendor/|^packages/ui/src/tokens/|^packages/ui/src/adapters/|^packages/ui/src/index\.ts$'
echo "$CHANGED" | grep -E "$PROTECTED_PATTERN" >/dev/null 2>&1 || exit 0
[ -n "$NO_GUARDRAILS_REMINDER" ] && exit 0

echo "⚠️  Guardrails are DISABLED and protected files were changed in the last commit."
echo "    Re-enable: GUARDRAILS_TOKEN=ok npm run guardrails:enable"
exit 0
